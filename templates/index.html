<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ITç”¨èªæ²ç¤ºæ¿</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <h1 style="margin-top:0;">ITç”¨èªæ²ç¤ºæ¿</h1>
        <form method="POST" enctype="multipart/form-data" class="post-form">
        <div class="field">
            <label for="wordInput">ç”¨èª:</label>
            <input id="wordInput" name="word" type="text" value="{{ request.form.word or '' }}" required>
        </div>
        <div class="field">
            <label for="textInput">èª¬æ˜:</label>
            <textarea id="textInput" name="text" rows="5" cols="50">{{ request.form.text }}</textarea>
        </div>
        <div class="field">
            <label for="urlInput">é–¢é€£URLï¼ˆä»»æ„ï¼‰</label>
            <input id="urlInput" name="url" type="url" value="{{ request.form.url or '' }}">
        </div>
                <div class="field">
                    <label for="imageInput">ç”»åƒï¼ˆä»»æ„ï¼‰</label>
                    <input id="imageInput" name="image" type="file" accept="image/*">
                </div>
            <button type="submit">è¿½åŠ </button>
            <button type="button" onclick="clearText()">ã‚¯ãƒªã‚¢</button>
        </form>
        {% if result and result.error %}
            <div style="color:#b00020; margin-top:8px; font-weight:600;">{{ result.error }}</div>
        {% endif %}

        <div class="search-row">
            <form method="GET" action="/" style="display:flex; gap:8px; width:100%;">
                <input name="q" placeholder="ç”¨èªã§æ¤œç´¢" value="{{ q or request.args.get('q','') }}" style="max-width:220px;">
                <input name="q_text" placeholder="èª¬æ˜ã§æ¤œç´¢" value="{{ q_text or request.args.get('q_text','') }}" style="flex:1;">
                <button type="submit">æ¤œç´¢</button>
                <a href="/" class="btn--edit" style="background:#6c757d; color:#fff; padding:8px 12px; border-radius:6px; text-decoration:none;">ã‚¯ãƒªã‚¢</a>
            </form>
        </div>

    <!-- <h2>ä¸€è¦§</h2>
    <form method="POST" action="/delete" onsubmit="return confirm('æœ¬å½“ã«å±¥æ­´ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ');">
        <button type="submit">å±¥æ­´ã‚’ã™ã¹ã¦å‰Šé™¤</button>
    </form> -->
    <table border="1">
        <tr>
            <th>ç”¨èª</th>
            <th>èª¬æ˜</th>
            <th>é–¢é€£URL</th>
            <th></th>
        </tr>
        {% for row in history %}
        <tr>
                    <tr>
                        {% if row[4] %}
                            <td>
                                <div style="margin-top:6px;">{{ row[3] }}</div>
                                <a href="#" onclick="showImage('{{ url_for('static', filename='uploads/' + row[4]) }}'); return false;">
                                    <img src="{{ url_for('static', filename='uploads/' + row[4]) }}" alt="" style="max-width:120px; max-height:80px; display:block; object-fit:cover; border-radius:4px;">
                                </a>
                            </td>
                        {% else %}
                            <td>{{ row[3] }}</td>
                        {% endif %}
                    
                <td>{{ row[2] }}</td>
                <td>
                    {% if row[5] %}
                        <a href="{{ row[5] }}" target="_blank" style="color:#0066cc; text-decoration:none;">ğŸ“ ãƒªãƒ³ã‚¯</a>
                    {% else %}
                        <span style="color:#999;">-</span>
                    {% endif %}
                </td>
                <td>
                    <a class="btn btn--edit" href="/edit/{{ row[0] }}">ç·¨é›†</a>
                    <form method="POST" action="/delete/{{ row[0] }}" style="display:inline" onsubmit="return confirm('ã“ã®å±¥æ­´ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ');">
                        <button type="submit" class="btn btn--delete">å‰Šé™¤</button>
                    </form>
                </td>
        </tr>
        {% endfor %}
    </table>
    <!-- Image modal -->
    <div id="imgModal" style="display:none; position:fixed; z-index:1200; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.85);">
        <div style="position:absolute; inset:0; display:flex; align-items:center; justify-content:center;">
            <div style="position:relative; max-width:94vw; max-height:94vh;">
                <button id="imgModalClose" onclick="hideImage()" style="position:absolute; right:-12px; top:-12px; background:#fff; border-radius:50%; border:none; width:36px; height:36px; cursor:pointer; font-weight:700;">âœ•</button>
                <img id="imgModalImg" src="" alt="" style="display:block; max-width:94vw; max-height:94vh; object-fit:contain; border-radius:6px;">
            </div>
        </div>
    </div>
    <script>
    function clearText() {
        document.getElementById("textInput").value = "";
    }
    function showImage(src){
        var modal = document.getElementById('imgModal');
        var img = document.getElementById('imgModalImg');
        img.src = src;
        modal.style.display = 'flex';
        // allow click outside image to close
        modal.onclick = function(e){ if(e.target===modal) hideImage(); };
    }
    function hideImage(){
        var modal = document.getElementById('imgModal');
        var img = document.getElementById('imgModalImg');
        img.src = '';
        modal.style.display = 'none';
    }
    </script>

</body>
</html>
