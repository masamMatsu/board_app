<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>IT用語掲示板</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <h1 style="margin-top:0;">IT用語掲示板</h1>
        <form method="POST" enctype="multipart/form-data" class="post-form">
        <div class="field">
            <label for="wordInput">用語:</label>
            <input id="wordInput" name="word" type="text" value="{{ request.form.word or '' }}" required>
        </div>
        <div class="field">
            <label for="textInput">説明:</label>
            <textarea id="textInput" name="text" rows="5" cols="50">{{ request.form.text }}</textarea>
        </div>
                <div class="field">
                    <label for="imageInput">画像（任意）</label>
                    <input id="imageInput" name="image" type="file" accept="image/*">
                </div>
            <button type="submit">追加</button>
            <button type="button" onclick="clearText()">クリア</button>
        </form>
        {% if result and result.error %}
            <div style="color:#b00020; margin-top:8px; font-weight:600;">{{ result.error }}</div>
        {% endif %}

        <div class="search-row">
            <form method="GET" action="/" style="display:flex; gap:8px; width:100%;">
                <input name="q" placeholder="用語で検索" value="{{ q or request.args.get('q','') }}" style="max-width:220px;">
                <input name="q_text" placeholder="説明で検索" value="{{ q_text or request.args.get('q_text','') }}" style="flex:1;">
                <button type="submit">検索</button>
                <a href="/" class="btn--edit" style="background:#6c757d; color:#fff; padding:8px 12px; border-radius:6px; text-decoration:none;">クリア</a>
            </form>
        </div>

    <!-- <h2>一覧</h2>
    <form method="POST" action="/delete" onsubmit="return confirm('本当に履歴を削除しますか？');">
        <button type="submit">履歴をすべて削除</button>
    </form> -->
    <table border="1">
        <tr>
            <th>用語</th>
            <th>説明</th>
            <th></th>
        </tr>
        {% for row in history %}
        <tr>
                    <tr>
                        {% if row[4] %}
                            <td>
                                <div style="margin-top:6px;">{{ row[3] }}</div>
                                <a href="#" onclick="showImage('{{ url_for('static', filename='uploads/' + row[4]) }}'); return false;">
                                    <img src="{{ url_for('static', filename='uploads/' + row[4]) }}" alt="" style="max-width:120px; max-height:80px; display:block; object-fit:cover; border-radius:4px;">
                                </a>
                            </td>
                        {% else %}
                            <td>{{ row[3] }}</td>
                        {% endif %}
                    
                <td>{{ row[2] }}</td>
                <td>
                    <a class="btn btn--edit" href="/edit/{{ row[0] }}">編集</a>
                    <form method="POST" action="/delete/{{ row[0] }}" style="display:inline" onsubmit="return confirm('この履歴を削除しますか？');">
                        <button type="submit" class="btn btn--delete">削除</button>
                    </form>
                </td>
        </tr>
        {% endfor %}
    </table>
    <!-- Image modal -->
    <div id="imgModal" style="display:none; position:fixed; z-index:1200; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.85);">
        <div style="position:absolute; inset:0; display:flex; align-items:center; justify-content:center;">
            <div style="position:relative; max-width:94vw; max-height:94vh;">
                <button id="imgModalClose" onclick="hideImage()" style="position:absolute; right:-12px; top:-12px; background:#fff; border-radius:50%; border:none; width:36px; height:36px; cursor:pointer; font-weight:700;">✕</button>
                <img id="imgModalImg" src="" alt="" style="display:block; max-width:94vw; max-height:94vh; object-fit:contain; border-radius:6px;">
            </div>
        </div>
    </div>
    <script>
    function clearText() {
        document.getElementById("textInput").value = "";
    }
    function showImage(src){
        var modal = document.getElementById('imgModal');
        var img = document.getElementById('imgModalImg');
        img.src = src;
        modal.style.display = 'flex';
        // allow click outside image to close
        modal.onclick = function(e){ if(e.target===modal) hideImage(); };
    }
    function hideImage(){
        var modal = document.getElementById('imgModal');
        var img = document.getElementById('imgModalImg');
        img.src = '';
        modal.style.display = 'none';
    }
    </script>

</body>
</html>
